@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Base navy - single source of truth */
  --navy-h: 222;
  --navy-s: 47%;
  --navy-l: 11%;

  /* Surface elevation system (lightness offsets) */
  --surface-0: hsl(var(--navy-h), var(--navy-s), 5%);      /* Canvas - deepest */
  --surface-1: hsl(var(--navy-h), var(--navy-s), 8%);      /* Recessed panels */
  --surface-2: hsl(var(--navy-h), var(--navy-s), 11%);     /* Default panels */
  --surface-3: hsl(var(--navy-h), var(--navy-s), 14%);     /* Raised panels */
  --surface-4: hsl(var(--navy-h), var(--navy-s), 18%);     /* Hover/elevated */

  /* Edge highlights for depth */
  --edge-light: rgba(255, 255, 255, 0.06);
  --edge-dark: rgba(0, 0, 0, 0.3);

  /* Log panel colors (GitHub dark theme) */
  --log-bg: #0d1117;
  --log-text: #e6edf3;
  --log-muted: #7d8590;
  --log-error: #f85149;
  --log-warning: #d29922;
  --log-success: #3fb950;
  --log-info: #79c0ff;
}

@layer base {
  * {
    box-sizing: border-box;
  }

  html,
  body,
  #root {
    height: 100%;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", Roboto,
      sans-serif;
    background-color: theme("colors.background.DEFAULT");
    color: theme("colors.text.primary");
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: theme("colors.text.muted");
    border-radius: 4px;
    opacity: 0.5;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: theme("colors.text.secondary");
  }
}

@layer components {
  /* ========================================
     Panel Depth System
     Uses layered shadows + gradients for elegant depth
     ======================================== */

  /* Toolbar - raised with bottom edge shadow */
  .panel-toolbar {
    background: linear-gradient(
      180deg,
      var(--surface-3) 0%,
      var(--surface-2) 100%
    );
    box-shadow:
      inset 0 1px 0 var(--edge-light),
      0 1px 3px var(--edge-dark),
      0 4px 12px -4px rgba(0, 0, 0, 0.4);
  }

  /* Sidebar - subtle inset with right/left edge glow */
  .panel-sidebar {
    background: linear-gradient(
      90deg,
      var(--surface-2) 0%,
      var(--surface-1) 100%
    );
    box-shadow:
      inset 0 1px 0 var(--edge-light),
      inset -1px 0 0 var(--edge-light);
  }

  /* Sidebar right variant (for properties panel) */
  .panel-sidebar-right {
    background: linear-gradient(
      270deg,
      var(--surface-2) 0%,
      var(--surface-1) 100%
    );
    box-shadow:
      inset 0 1px 0 var(--edge-light),
      inset 1px 0 0 var(--edge-light);
  }

  /* Footer - recessed with top edge shadow */
  .panel-footer {
    background: var(--surface-1);
    box-shadow:
      inset 0 1px 0 var(--edge-light),
      inset 0 2px 8px -2px rgba(0, 0, 0, 0.3);
  }

  /* Canvas pit - deepest with vignette effect */
  .panel-canvas {
    background: radial-gradient(
      ellipse at center,
      var(--surface-0) 0%,
      hsl(var(--navy-h), var(--navy-s), 3%) 100%
    );
  }

  /* Glass morphism panel */
  .glass-panel {
    @apply bg-background-surface/80 backdrop-blur-xl border border-white/5 rounded-lg;
  }

  /* Focus ring utility */
  .focus-ring {
    @apply outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-background;
  }

  /* Node base styling */
  .node-base {
    @apply rounded-xl p-3 backdrop-blur-sm border border-white/10 transition-all duration-200;
  }

  /* Button base */
  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-lg text-sm font-medium transition-all duration-200;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-background;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }

  .btn-primary {
    @apply btn bg-accent text-background hover:bg-accent/90 shadow-md px-4 py-2;
  }

  .btn-secondary {
    @apply btn bg-background-elevated text-text-secondary hover:bg-background-surface hover:text-text-primary px-4 py-2;
  }

  .btn-ghost {
    @apply btn hover:bg-background-elevated hover:text-text-primary px-3 py-2;
  }

  .btn-destructive {
    @apply btn bg-state-error text-white hover:bg-state-error/90 shadow-md px-4 py-2;
  }

  /* Input base */
  .input {
    @apply w-full rounded-lg border border-white/10 bg-background-surface px-3 py-2 text-sm text-text-primary;
    @apply placeholder:text-text-muted;
    @apply focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-1 focus:ring-offset-background;
    @apply disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Select base */
  .select {
    @apply input appearance-none pr-8 cursor-pointer;
  }
}

/* ReactFlow overrides for GitHub Dark theme */
.react-flow__background {
  background: radial-gradient(
    ellipse at center,
    hsl(222, 47%, 11%) 0%,
    hsl(222, 47%, 6%) 100%
  ) !important;
}

.react-flow__minimap {
  background-color: #161b22 !important;
  border-radius: theme("borderRadius.lg") !important;
  border: 1px solid #30363d !important;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4) !important;
}

.react-flow__minimap-mask {
  fill: rgba(13, 17, 23, 0.85) !important;
}

.react-flow__controls {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

.react-flow__controls-button {
  background: #161b22 !important;
  border: 1px solid #30363d !important;
  border-radius: theme("borderRadius.sm") !important;
  color: #8b949e !important;
  transition: all 150ms ease-out !important;
}

.react-flow__controls-button:hover {
  background: #21262d !important;
  color: #e6edf3 !important;
  border-color: #58a6ff !important;
}

.react-flow__controls-button svg {
  fill: currentColor !important;
}

/* Edge styling */
.react-flow__edge-path {
  stroke: #6e7681 !important;
  stroke-width: 2 !important;
}

.react-flow__edge.selected .react-flow__edge-path {
  stroke: #58a6ff !important;
  stroke-width: 2.5 !important;
}

.react-flow__edge:hover .react-flow__edge-path {
  stroke: #8b949e !important;
}

/* Animated edge for running state */
.react-flow__edge.animated .react-flow__edge-path {
  stroke-dasharray: 5 !important;
  animation: edge-flow 0.5s linear infinite !important;
}

@keyframes edge-flow {
  to {
    stroke-dashoffset: -10;
  }
}

/* Connection line when dragging */
.react-flow__connection-line {
  stroke: #58a6ff !important;
  stroke-width: 2 !important;
  stroke-dasharray: 5 5 !important;
}

/* Handle styling */
.react-flow__handle {
  width: 12px !important;
  height: 12px !important;
  background: #21262d !important;
  border: 2px solid #6e7681 !important;
  transition: all 150ms ease-out !important;
}

.react-flow__handle:hover {
  border-color: #58a6ff !important;
  background: #30363d !important;
  transform: scale(1.2);
}

.react-flow__handle-connecting {
  background: #58a6ff !important;
  border-color: #58a6ff !important;
}

.react-flow__handle-valid {
  background: #3fb950 !important;
  border-color: #3fb950 !important;
}

/* Selection box */
.react-flow__selection {
  background: rgba(88, 166, 255, 0.08) !important;
  border: 1px dashed #58a6ff !important;
  border-radius: 4px !important;
}

/* Node selection styling */
.react-flow__node.selected {
  box-shadow: 0 0 0 2px #58a6ff, 0 8px 24px rgba(0, 0, 0, 0.4) !important;
}

/* Panel styling (for any floating panels) */
.react-flow__panel {
  background: transparent !important;
}
